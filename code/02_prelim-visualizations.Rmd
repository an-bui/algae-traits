---
title: "preliminary visualizations"
author: "An Bui"
date: "10/6/2021"
output: 
  html_document:
    toc: yes
    toc_depth: 4
    toc_float:
      collapsed: no
    theme: readable
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# 0. set up
```{r message = FALSE, warning = FALSE, echo = FALSE}
# source the cleaning/summarizing script, which sources the set up
source(here::here("code", "01_cleaning-and-summarizing.R"))
```

# 1. FvFm 

## a. analysis of variance

```{r}
fvfm_df <- fvfm_raw %>% 
  # only use FvFm, drop the NAs, change the column name
  select(specimen_ID, '1:Fv/Fm') %>% 
  drop_na() %>%
  rename('fvfm_meas' = '1:Fv/Fm') %>% 
  # make sure that fvfm_meas is numeric
  mutate(fvfm_meas = as.numeric(fvfm_meas)) %>% 
  # join with metadata: spp codes + specimen_ID
  left_join(., metadata, by = "specimen_ID") %>% 
  # join with coarse_traits
  left_join(., coarse_traits, by = "sp_code") %>% 
  filter(sp_code %in% algae_proposal)

bartlett.test(fvfm_meas ~ sp_code, data = fvfm_df)
# definitely heterogeneous variances

# analysis of variance
fvfm_sp_aov <- aov(fvfm_meas ~ sp_code, data = fvfm_df)

fvfm_tax_aov <- aov(fvfm_meas ~ taxon_phylum, data = fvfm_df)

summary(fvfm_sp_aov)
summary(fvfm_tax_aov)
# both significant

# Tukey HSD
fvfm_tukey <- TukeyHSD(fvfm_sp_aov)

# compact letter display
fvfm_cld <- multcompLetters4(fvfm_sp_aov, fvfm_tukey)

# output of compact letter display in data frame
fvfm_cld_df <- enframe(fvfm_cld[[1]]$Letters) %>% 
  rename(sp_code = "name")
```

## b. box plot

```{r}
fvfm_boxplot <- fvfm_summary %>% 
  left_join(., fvfm_cld_df, by = "sp_code") %>% 
  group_by(sp_code) %>% 
  ggplot(aes(x = sp_code, y = mean, group = sp_code)) +
  geom_boxplot(aes(fill = value)) +
  geom_jitter() +
  geom_text(aes(label = value, y = max(mean)), nudge_y = 0.01) + 
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw() +
  labs(title = "Photosynthetic efficiency",
       x = "Species code",
       y = "Fv/Fm") +
  theme(legend.position = "none")

fvfm_boxplot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("fvfm-boxplot-", todays_date, ".jpg", sep = "")),
#        fvfm_boxplot,
#        width = 8, height = 5, dpi = 150)
```

## c. boxplot (PTCA adults vs recruits)

```{r}
test <- fvfm_raw %>% 
  rename('fvfm_meas' = '1:Fv/Fm') %>% 
  mutate(fvfm_meas = as.numeric(fvfm_meas)) %>% 
  select(specimen_ID, subsample_ID, fvfm_meas) %>% 
  group_by(specimen_ID) %>% 
  summarize(mean = mean(fvfm_meas),
            var = var(fvfm_meas),
            sd = sd(fvfm_meas)) %>% 
  left_join(., metadata, by = "specimen_ID") %>% 
  filter(sp_code == "PTCA" & site %in% c("Mohawk", "Arroyo Quemado")) %>% 
  mutate(lifestage = case_when(
    date_collected %in% c("20220405", "20220407") ~ "adult",
    TRUE ~ "new_recruit"
  ))

var.test(mean ~ lifestage, data = test %>% filter(site == "Arroyo Quemado"))
var.test(mean ~ lifestage, data = test %>% filter(site == "Mohawk"))
# both homogeneous variances

t.test(mean ~ lifestage, data = test %>% filter(site == "Arroyo Quemado"), var.equal = TRUE)
t.test(mean ~ lifestage, data = test %>% filter(site == "Mohawk"), var.equal = TRUE)

var.test(mean ~ site, data = test %>% filter(lifestage == "adult"))
var.test(mean ~ site, data = test %>% filter(lifestage == "new_recruit"))
# homogeneous variance
t.test(mean ~ site, data = test %>% filter(lifestage == "adult"), var.equal = TRUE)
t.test(mean ~ site, data = test %>% filter(lifestage == "new_recruit"), var.equal = TRUE)
# not significantly different

test_plot <- fvfm_raw %>% 
  rename('fvfm_meas' = '1:Fv/Fm') %>% 
  mutate(fvfm_meas = as.numeric(fvfm_meas)) %>% 
  select(specimen_ID, subsample_ID, fvfm_meas) %>% 
  group_by(specimen_ID) %>% 
  summarize(mean = mean(fvfm_meas),
            var = var(fvfm_meas),
            sd = sd(fvfm_meas)) %>% 
  left_join(., metadata, by = "specimen_ID") %>% 
  filter(sp_code == "PTCA" & site %in% c("Mohawk", "Arroyo Quemado")) %>% 
  mutate(lifestage = case_when(
    date_collected %in% c("20220405", "20220407") ~ "adult",
    TRUE ~ "new_recruit"
  )) %>% 
  ggplot(aes(x = lifestage, y = mean)) +
  geom_boxplot(aes(fill = lifestage)) +
  geom_jitter() +
  scale_fill_manual(values = c("#70601d", "#b59b33")) +
  facet_wrap(~site) +
  theme_bw() +
  theme(legend.position = "none") +
  labs(title = "PTCA Fv/Fm",
       caption = "t-test: Arroyo Quemado: t(14) = 9.4, p < 0.001, Mohawk: t(28) = 7.13, p < 0.001") 

test_plot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("fvfm-boxplot-lifestage-", todays_date, ".jpg", sep = "")),
#        test_plot,
#        width = 8, height = 5, dpi = 150)
```

## d. boxplot (PTCA recruits across sites)

```{r}
fvfm_ptca <- fvfm_raw %>% 
  rename('fvfm_meas' = '1:Fv/Fm') %>% 
  mutate(fvfm_meas = as.numeric(fvfm_meas)) %>% 
  select(specimen_ID, subsample_ID, fvfm_meas) %>% 
  group_by(specimen_ID) %>% 
  summarize(mean = mean(fvfm_meas),
            var = var(fvfm_meas),
            sd = sd(fvfm_meas)) %>% 
  left_join(., metadata, by = "specimen_ID") %>% 
  filter(sp_code == "PTCA") %>% 
  mutate(lifestage = case_when(
    date_collected %in% c("20220405", "20220407") ~ "adult",
    TRUE ~ "new_recruit"
  )) %>% 
  filter(lifestage == "new_recruit")

bartlett.test(mean ~ site, data = fvfm_ptca)
# significantly different variances
leveneTest(mean ~ site, data = fvfm_ptca)

summary(aov(mean ~ site, 
            data = fvfm_ptca %>% 
              filter(lifestage == "new_recruit" & 
              site %in% c("Arroyo Quemado", "Bullito", "Mohawk"))))

fvfm_boxplot_ptca <- fvfm_ptca %>% 
  filter(lifestage == "new_recruit" & 
           site %in% c("Arroyo Quemado", "Bullito", "Mohawk")) %>% 
  ggplot(aes(x = site, y = mean)) +
  geom_boxplot() +
  geom_jitter() +
  theme_bw()
fvfm_boxplot_ptca

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("fvfm-boxplot-PTCA_recruits-", todays_date, ".jpg", sep = "")),
#        fvfm_boxplot_ptca,
#        width = 8, height = 5, dpi = 150)
```

## e. boxplot (PTCA adults across sites)

```{r}
fvfm_ptca <- fvfm_raw %>% 
  rename('fvfm_meas' = '1:Fv/Fm') %>% 
  mutate(fvfm_meas = as.numeric(fvfm_meas)) %>% 
  select(specimen_ID, subsample_ID, fvfm_meas) %>% 
  group_by(specimen_ID) %>% 
  summarize(mean = mean(fvfm_meas),
            var = var(fvfm_meas),
            sd = sd(fvfm_meas)) %>% 
  left_join(., metadata, by = "specimen_ID") %>% 
  filter(sp_code == "PTCA") %>% 
  mutate(lifestage = case_when(
    date_collected %in% c("20220405", "20220407") ~ "adult",
    TRUE ~ "new_recruit"
  )) %>% 
  filter(lifestage == "adult")

bartlett.test(mean ~ site, data = fvfm_ptca)
# not significantly different variances
leveneTest(mean ~ site, data = fvfm_ptca)

t.test(mean ~ site, data = fvfm_ptca, var.equal = TRUE)
# no significant differences in adults

fvfm_boxplot_ptca <- fvfm_ptca %>% 
  filter(lifestage == "adult" & 
           site %in% c("Arroyo Quemado", "Mohawk")) %>% 
  ggplot(aes(x = site, y = mean)) +
  geom_boxplot() +
  geom_jitter() +
  theme_bw() +
  labs(caption = "t-test: t(13) = 0.97, p = 0.35")
fvfm_boxplot_ptca

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("fvfm-boxplot-PTCA_adults-", todays_date, ".jpg", sep = "")),
#        fvfm_boxplot_ptca,
#        width = 8, height = 5, dpi = 150)
```

## f. boxplot (BF BULL vs IVEE)

```{r}
bf_fvfm <- fvfm_raw %>% 
  rename('fvfm_meas' = '1:Fv/Fm') %>% 
  mutate(fvfm_meas = as.numeric(fvfm_meas)) %>% 
  select(specimen_ID, subsample_ID, fvfm_meas) %>% 
  group_by(specimen_ID) %>% 
  summarize(mean = mean(fvfm_meas),
            var = var(fvfm_meas),
            sd = sd(fvfm_meas)) %>% 
  left_join(., metadata, by = "specimen_ID") %>% 
  filter(sp_code == "BF" & site %in% c("Bullito", "Isla Vista"))

var.test(mean ~ site, data = bf_fvfm)
# homogeneous variances, use t-test
t.test(mean ~ site, data = bf_fvfm, var.equal = TRUE)

bf_tukey <- TukeyHSD(bf_aov)
bf_tukey

bf_plot <- fvfm_raw %>% 
  rename('fvfm_meas' = '1:Fv/Fm') %>% 
  mutate(fvfm_meas = as.numeric(fvfm_meas)) %>% 
  select(specimen_ID, subsample_ID, fvfm_meas) %>% 
  group_by(specimen_ID) %>% 
  summarize(mean = mean(fvfm_meas),
            var = var(fvfm_meas),
            sd = sd(fvfm_meas)) %>% 
  left_join(., metadata, by = "specimen_ID") %>% 
  filter(sp_code == "BF" & site %in% c("Bullito", "Isla Vista")) %>% 
  ggplot(aes(x = site, y = mean)) +
  geom_boxplot(aes(fill = site)) +
  geom_jitter() +
  labs(title = "BF Fv/Fm",
       caption = "t-test: t(22) = 2.46, p = 0.02") +
  theme_bw() +
  theme(legend.position = "none")

bf_plot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("fvfm-boxplot-bf-", todays_date, ".jpg", sep = "")),
#        bf_plot,
#        width = 8, height = 5, dpi = 150)
```

# 2. Thickness

## a. analysis of variance

```{r}
thickness_df <- thickness %>% 
  pivot_longer(cols = thickness_01:thickness_10, names_to = "measurement_n", values_to = "thickness_mm") %>% 
  # replace NAs for 20210709-MOHK-004 with the quickfix value
  mutate(thickness_mm = replace(thickness_mm, 
                                is.na(thickness_mm) & specimen_ID == "20210709-MOHK-004", 
                                quickfix)) %>% 
  group_by(specimen_ID) %>% 
  # join with metadata_subsamples: spp codes + specimen_ID
  left_join(., metadata_subsamples, by = "specimen_ID") %>% 
  # join with coarse_traits
  left_join(., coarse_traits, by = "sp_code") %>% 
  unique()

bartlett.test(thickness_mm.x ~ sp_code, data = thickness_df)
# definitely heterogeneous variances

# analysis of variance
thickness_sp_aov <- aov(thickness_mm.x ~ sp_code, data = thickness_df)

thickness_tax_aov <- aov(thickness_mm.x ~ taxon_phylum, data = thickness_df)

summary(thickness_sp_aov)
summary(thickness_tax_aov)
# both significant

# Tukey HSD
thickness_tukey <- TukeyHSD(thickness_sp_aov)

# compact letter display
thickness_cld <- multcompLetters4(thickness_sp_aov, thickness_tukey)

# output of compact letter display in data frame
thickness_cld_df <- enframe(thickness_cld[[1]]$Letters) %>% 
  rename(sp_code = "name")
```


## b. box plot

```{r}
thickness_boxplot <- thickness_summary %>% 
  left_join(., thickness_cld_df, by = "sp_code") %>% 
  drop_na(site, mean) %>% 
  group_by(sp_code) %>% 
  ggplot(aes(x = sp_code, y = mean, group = sp_code)) +
  geom_boxplot(aes(fill = value)) +
  geom_jitter() +
  geom_text(aes(label = value, y = max(mean)), nudge_y = 0.01) + 
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw() +
  labs(title = "Thallus thickness",
       x = "Species code",
       y = "Thickness (mm)") +
  theme(legend.position = "none")

thickness_boxplot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("thickness-boxplot-", todays_date, ".jpg", sep = "")),
#        thickness_boxplot,
#        width = 8, height = 5, dpi = 150)
```

## c. boxplot (BF BULL vs IVEE)

```{r}
var.test(mean ~ site, data = thickness_summary %>% filter(sp_code == "BF"))
# homogeneous variance, can use two-sample t-test
t.test(mean ~ site, data = thickness_summary %>% filter(sp_code == "BF"), var.equal = TRUE)

thickness_boxplot_bf <- thickness_summary %>% 
  filter(sp_code == "BF") %>% 
  group_by(sp_code) %>% 
  ggplot(aes(x = site, y = mean)) +
  geom_boxplot(aes(fill = site)) +
  # geom_jitter() +
  geom_text(aes(x = site, y = mean, label = specimen_ID)) +
  theme_bw() +
  labs(title = "BF thallus thickness",
       x = "Site",
       y = "Thickness (mm)",
       caption = "t-test: t(22) = 2.3, p = 0.03") +
  theme(legend.position = "none")

thickness_boxplot_bf

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("thickness-boxplot-bf-", todays_date, ".jpg", sep = "")),
#        thickness_boxplot_bf,
#        width = 8, height = 5, dpi = 150)

```

## d. boxplot (PTCA adults vs recruits)

```{r}
thickness_ptca <- thickness_summary %>% 
  filter(sp_code == "PTCA") %>% 
  filter(site %in% c("Mohawk")) %>% 
  mutate(lifestage = case_when(
    date_collected %in% c("20220405", "20220407") ~ "adult",
    TRUE ~ "new_recruit"
  )) 

var.test(mean ~ lifestage, data = thickness_ptca)
bartlett.test(mean ~ lifestage, data = thickness_ptca)
leveneTest(mean ~ lifestage, data = thickness_ptca)
# significantly different variances

summary(aov(mean ~ lifestage, 
            data = thickness_ptca %>% 
              filter(site %in% c("Mohawk"))))
# significantly different between lifestages

thickness_boxplot_ptca <- thickness_ptca %>% 
  filter(site %in% c("Mohawk")) %>% 
  ggplot(aes(x = lifestage, y = mean)) +
  geom_boxplot(aes(fill = lifestage)) +
  scale_fill_manual(values = c("#70601d", "#b59b33")) +
  geom_jitter() +
  theme_bw() +
  facet_wrap(~site) +
  labs(title = "PTCA adult vs recruit thickness",
       y = "mm",
       caption = "significantly different variances") +
  theme(legend.position = "none")
thickness_boxplot_ptca

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("thickness-boxplot-lifestage-", todays_date, ".jpg", sep = "")),
#        thickness_boxplot_ptca,
#        width = 8, height = 5, dpi = 150)
```


# 3. Weights

## a. analysis of variance

```{r}
# analysis of variance
dryw_sp_aov <- aov(weight_dry_mg ~ sp_code, data = weight_summary %>% filter(!(sp_code %in% c("BO", "CO"))))

dryw_tax_aov <- aov(weight_dry_mg ~ taxon_phylum, data = weight_summary %>% filter(!(sp_code %in% c("BO", "CO"))))

summary(dryw_sp_aov)
summary(dryw_tax_aov)
# species significant, phylum not significant

# Tukey HSD
dryw_tukey <- TukeyHSD(dryw_sp_aov)

# compact letter display
dryw_cld <- multcompLetters4(dryw_sp_aov, dryw_tukey)

# output of compact letter display in data frame
dryw_cld_df <- enframe(dryw_cld[[1]]$Letters) %>% 
  rename(sp_code = "name")

# test homogeneity of variance
# bartlett.test(tdmc ~ sp_code, data = weight_summary %>% filter(!(sp_code %in% c("BO", "CO"))))

# analysis of variance
tdmc_sp_aov <- aov(tdmc ~ sp_code, data = weight_summary %>% filter(!(sp_code %in% c("BO", "CO"))))

tdmc_tax_aov <- aov(tdmc ~ taxon_phylum, data = weight_summary %>% filter(!(sp_code %in% c("BO", "CO"))))

summary(tdmc_sp_aov)
summary(tdmc_tax_aov)
# species not significant, phylum significant???

# Tukey HSD
tdmc_tukey <- TukeyHSD(tdmc_sp_aov)

# compact letter display
tdmc_cld <- multcompLetters4(tdmc_sp_aov, tdmc_tukey)

# output of compact letter display in data frame
tdmc_cld_df <- enframe(tdmc_cld[[1]]$Letters) %>% 
  rename(taxon_phylum = "name")
```


## b. box plot

```{r}
dryw_boxplot <- weight_summary %>% 
  filter(sp_code != "BO") %>% 
  left_join(., dryw_cld_df, by = "sp_code") %>% 
  ggplot(aes(x = sp_code, y = weight_dry_g)) +
  geom_boxplot(aes(fill = value)) +
  geom_jitter() +
  geom_text(aes(label = value, y = 9), nudge_y = 0.01) + 
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw() +
  labs(title = "Oven dry weight",
       x = "Species code",
       y = "Dry weight (g)") +
  theme(legend.position = "none")

dryw_boxplot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("dryw-boxplot-", todays_date, ".jpg", sep = "")),
#        dryw_boxplot,
#        width = 8, height = 5, dpi = 150)

wetw_boxplot <- ggplot(weight_summary, aes(x = sp_code, y = weight_wet_g)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.45) +
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw()  +
  labs(title = "Fresh wet weight",
       x = "Species code",
       y = "Wet weight (g)")

wetw_boxplot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("wetw-boxplot-", todays_date, ".jpg", sep = "")),
#        wetw_boxplot,
#        width = 8, height = 5, dpi = 150)

tdmc_boxplot <- weight_summary %>% 
  filter(!(sp_code %in% c("BO", "CO"))) %>% 
  left_join(., tdmc_cld_df, by = "taxon_phylum") %>% 
  ggplot(aes(x = sp_code, y = tdmc)) +
  geom_boxplot(aes(fill = value)) +
  geom_jitter() +
  geom_text(aes(label = value, y = 0.3), nudge_y = 0.01) + 
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_y_continuous(limits = c(0, 0.4)) +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw() +
  labs(title = "Thallus dry matter content",
       x = "Species code",
       y = "g dry weight/g wet weight")

tdmc_boxplot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("tdmc_boxplot-", todays_date, ".jpg", sep = "")),
#        tdmc_boxplot,
#        width = 8, height = 5, dpi = 150)
```

As a note: something needs to happen to be able to filter out the things that are true thalli (e.g. thallus on PTCA) AND things that are whole individuals that are basically thalli (e.g. BF). Maybe code those in as "thallus" and go from there?  

Note: Changed that on 2021-10-25. If it's a whole individual that is a thallus, it's coded in as "thallus" in the weight data sheet.

## c. boxplot (TDMC, BF BULL vs IVEE)

```{r}
var.test(tdmc ~ site, data = weight_summary %>% filter(sp_code == "BF"))
# homogeneous variance
t.test(tdmc ~ site, data = weight_summary %>% filter(sp_code == "BF"), var.equal = TRUE)
# not significantly different

tdmc_boxplot_bf <- weight_summary %>% 
  filter(sp_code == "BF") %>% 
  ggplot(aes(x = site, y = tdmc)) +
  geom_boxplot(aes(fill = site)) +
  geom_jitter() +
  theme_bw() +
  labs(title = "BF TDMC",
       x = "Site",
       y = "TDMC",
       caption = "t-test: t(22) = 1.85, p = 0.07") +
  theme(legend.position = "none")

tdmc_boxplot_bf

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("tdmc-boxplot-bf-", todays_date, ".jpg", sep = "")),
#        tdmc_boxplot_bf,
#        width = 8, height = 5, dpi = 150)
```

## d. boxplot (dry weight, BF BULL vs IVEE)

```{r}
var.test(weight_dry_mg ~ site, data = weight_summary %>% filter(sp_code == "BF"))
# heterogeneous variance
t.test(weight_dry_mg ~ site, data = weight_summary %>% filter(sp_code == "BF"), var.equal = FALSE)
# not significantly different

dryw_boxplot_bf <- weight_summary %>% 
  filter(sp_code == "BF") %>% 
  ggplot(aes(x = site, y = weight_dry_mg)) +
  geom_boxplot(aes(fill = site)) +
  geom_jitter() +
  theme_bw() +
  labs(title = "BF dry weight",
       x = "Site",
       y = "Weight (mg)",
       caption = "t-test: t(18.33) = 1.88, p = 0.07") +
  theme(legend.position = "none")

dryw_boxplot_bf

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("dryw-boxplot-bf-", todays_date, ".jpg", sep = "")),
#        dryw_boxplot_bf,
#        width = 8, height = 5, dpi = 150)
```



# 4. volume

## a. box plot
```{r}
volume_boxplot <- ggplot(volume_summary, aes(x = sp_code, y = volume_total_mL)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.45) +
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw() +
  labs(title = "Volume",
       x = "Species code",
       y = "Volume (mL)")

volume_boxplot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("volume-boxplot-", todays_date, ".jpg", sep = "")),
#        volume_boxplot,
#        width = 8, height = 5, dpi = 150)
```

# 5. surface area

## a. box plot
```{r}
sa_boxplot <- ggplot(sa_peri_summary, aes(x = sp_code, y = area_total)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.45) +
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw() +
  labs(title = "Surface area",
       x = "Species code",
       y = bquote("Square millimeter "(mm^2)))

sa_boxplot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("sa-boxplot-", todays_date, ".jpg", sep = "")),
#        sa_boxplot,
#        width = 8, height = 5, dpi = 150)
```

# 6. perimeter

## a. box plot
```{r}
peri_boxplot <- ggplot(sa_peri_summary, aes(x = sp_code, y = peri_total)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.45) +
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw() +
  labs(title = "Perimeter",
       x = "Species code",
       y = "Perimeter (mm)")

peri_boxplot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("peri_boxplot-", todays_date, ".jpg", sep = "")),
#        peri_boxplot,
#        width = 8, height = 5, dpi = 150)
```

# 7. surface area:perimeter ratio

## a. box plot

```{r}
ratio_saperi_boxplot <- ggplot(sa_peri_summary, aes(x = sp_code, y = ratio)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.45) +
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw() +
  labs(title = "Surface area:perimeter ratio",
       x = "Species code",
       y = expression(paste(mm^2, "per mm")))

ratio_saperi_boxplot 

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("ratio_saperi_boxplot-", todays_date, ".jpg", sep = "")),
#        ratio_saperi_boxplot,
#        width = 8, height = 5, dpi = 150)
```

# 8. surface area:volume ratio

## a. box plot
```{r}
ratio_savolume_boxplot <- ggplot(ratio_savolume, aes(x = sp_code, y = ratio)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.45) +
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw() +
  labs(title = "Surface area:volume ratio",
       x = "Species code",
       y = "mm^2/mL")

ratio_savolume_boxplot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("ratio_savolume_boxplot-", todays_date, ".jpg", sep = "")),
#        ratio_savolume_boxplot,
#        width = 8, height = 5, dpi = 150)
```

# 9. maximum height and width

```{r}
height_boxplot <- ggplot(hw_summary, aes(x = sp_code, y = max_height_cm)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.45) +
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw() +
  labs(title = "Maximum height",
       x = "Species code",
       y = "cm")

height_boxplot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("height_boxplot-", todays_date, ".jpg", sep = "")),
#        height_boxplot,
#        width = 8, height = 5, dpi = 150)

width_boxplot <- ggplot(hw_summary, aes(x = sp_code, y = max_width_cm)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.45) +
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw() +
  labs(title = "Maximum width",
       x = "Species code",
       y = "cm")

width_boxplot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("width_boxplot-", todays_date, ".jpg", sep = "")),
#        width_boxplot,
#        width = 8, height = 5, dpi = 150)
```


# 10. specific thallus area

## a. analysis of variance

```{r}
sta_df <- sta_summary %>% 
  drop_na(sta_mm_mg) %>% 
  slice(-125) %>% 
  filter(sp_code %in% algae_proposal) %>% 
  filter(sp_code != "CO")

# test homogeneity of variance
bartlett.test(sta_mm_mg ~ sp_code, data = sta_df)

# analysis of variance
sta_sp_aov <- aov(sta_mm_mg ~ sp_code, data = sta_df)

sta_tax_aov <- aov(sta_mm_mg ~ taxon_phylum, data = sta_df)

summary(sta_sp_aov)
summary(sta_tax_aov)
# both significant

# Tukey HSD
sta_tukey <- TukeyHSD(sta_sp_aov)

# compact letter display
sta_cld <- multcompLetters4(sta_sp_aov, sta_tukey)

# output of compact letter display in data frame
sta_cld_df <- enframe(sta_cld[[1]]$Letters) %>% 
  rename(sp_code = "name")
```

## b. boxplot

thallus area:dry weight

```{r}
sta_boxplot <- sta_summary %>% 
  drop_na(sta_mm_mg) %>% 
  slice(-125) %>% 
  left_join(., sta_cld_df, by = "sp_code") %>% 
  ggplot(aes(x = sp_code, y = sta_mm_mg)) +
  geom_boxplot(aes(fill = value)) +
  geom_jitter() +
  geom_text(aes(label = value, y = max(sta_mm_mg)*1.05), nudge_y = 0.01) + 
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw() +
  labs(title = "Specific thallus area",
       x = "Species code",
       y = "Thallus area/dry weight (mm^2/mg)")

sta_boxplot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("sta_boxplot-", todays_date, ".jpg", sep = "")),
#        sta_boxplot,
#        width = 8, height = 5, dpi = 150)
```

## c. boxplot (BF BULL vs IVEE)

```{r}
var.test(sta_mm_mg ~ site, data = sta_df %>% filter(sp_code == "BF"))
# heterogeneous variances
t.test(sta_mm_mg ~ site, data = sta_df %>% filter(sp_code == "BF"), var.equal = FALSE)
# no significant difference in means

sta_boxplot_bf <- sta_summary %>% 
  filter(sp_code == "BF") %>% 
  ggplot(aes(x = site, y = sta_mm_mg)) +
  geom_boxplot(aes(fill = site)) +
  geom_jitter() +
  theme_bw() +
  labs(title = "BF STA",
       x = "Site",
       y = "Thallus area/dry weight",
       caption = "Welch t-test: t(8.62) = -0.09, p = 0.93") +
  theme(legend.position = "none")

sta_boxplot_bf

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("sta-boxplot-bf-", todays_date, ".jpg", sep = "")),
#        sta_boxplot_bf,
#        width = 8, height = 5, dpi = 150)
```


# 11. branching order

```{r}
bra_ord_boxplot <- ggplot(bra_ord_summary, aes(x = sp_code, y = mean)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.45) +
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw() +
  labs(title = "Branching order",
       x = "Species code",
       y = "Branch count")

bra_ord_boxplot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("bra_ord_boxplot-", todays_date, ".jpg", sep = "")),
#        bra_ord_boxplot,
#        width = 8, height = 5, dpi = 150)
```

# 12. toughness

```{r}
toughness_boxplot <- ggplot(toughness_summary, aes(x = sp_code, y = mean)) +
  geom_boxplot() +
  geom_jitter(alpha = 0.45) +
  facet_wrap(~ pigment_type, scales = "free_x") +
  scale_x_discrete(guide = guide_axis(n.dodge = 2)) +
  theme_bw() +
  labs(title = "Toughness",
       x = "Species code",
       y = "kg/cm2")

toughness_boxplot

# ggsave(here::here("figures/prelim-visualizations",
#                   paste("toughness_boxplot-", todays_date, ".jpg", sep = "")),
#        toughness_boxplot,
#        width = 8, height = 5, dpi = 150)
```

# 13. correlation between STA and TDMC

```{r}
ggplot(sta_summary %>% filter(!(sp_code %in% c("Nandersoniana", "PTCA"))) %>% drop_na(tdmc), aes(x = sta_mm_mg, y = tdmc, col = sp_code)) +
  geom_point() +
  geom_smooth(aes(col = sp_code), method = "lm", se = FALSE) +
  geom_smooth(method = "lm", se = TRUE, col = "black")

sta_tdmc_lme <- lmer(tdmc ~ sta_mm_mg + (1|sp_code), data = sta_summary %>% filter(!(sp_code %in% c("Nandersoniana", "PTCA"))))
summary(sta_tdmc_lme)
testResiduals(sta_tdmc_lme)

sta_tdmc_lm <- lm(tdmc ~ sta_mm_mg*sp_code, data = sta_summary %>% filter(!(sp_code %in% c("Nandersoniana", "PTCA"))))
summary(sta_tdmc_lm)
testResiduals(sta_tdmc_lm)
```




```{r include = FALSE}
# Use `rmarkdown::render(here::here("code", "02_prelim-visualizations.Rmd"))` to knit the document.
```








